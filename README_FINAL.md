# üéâ –ò—Ç–æ–≥–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - Soobshio Project

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –†–µ–≤–∏–∑–∏—è –ø—Ä–æ–µ–∫—Ç–∞ ‚úÖ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏
- –£–±—Ä–∞–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
- –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Zai GLM-4.7 ‚úÖ
- –ó–∞–º–µ–Ω–∞ Claude –Ω–∞ Zai
- Nominatim –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- API endpoints

### 3. Flutter –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚úÖ
- –û–±–Ω–æ–≤–ª—ë–Ω AI –∫–ª–∏–µ–Ω—Ç
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ /ai/analyze endpoint
- Backward compatibility

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### Backend (Python)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env (–¥–æ–±–∞–≤–∏—Ç—å ZAI_API_KEY)
# 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
python -m backend.init_db

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å API
python main.py
```

**API:** http://127.0.0.1:8000

### Frontend (Flutter)

```bash
cd lib
flutter pub get
flutter run -d chrome
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
soobshio_project/
‚îú‚îÄ‚îÄ üìÑ main.py                    # FastAPI —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ üìÑ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ üìÑ .env                       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÑ PROJECT_REVISION.md        # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÑ QUICKSTART.md              # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îú‚îÄ‚îÄ üìÑ ZAI_INTEGRATION.md         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Zai
‚îú‚îÄ‚îÄ üìÑ ZAI_COMPLETE.md            # –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ üìÅ backend/                    # Backend API
‚îÇ   ‚îú‚îÄ‚îÄ database.py               # –ë–î –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models.py                 # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ main_api.py               # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                   # JWT auth
‚îÇ   ‚îî‚îÄ‚îÄ init_db.py                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ
‚îú‚îÄ‚îÄ üìÅ services/                   # –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ zai_service.py            # Zai GLM-4.7 (–Ω–æ–≤—ã–π!)
‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py             # AI –æ–±—ë—Ä—Ç–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ geo_service.py            # Nominatim
‚îÇ   ‚îú‚îÄ‚îÄ cluster_service.py        # HDBSCAN
‚îÇ   ‚îî‚îÄ‚îÄ telegram_parser.py        # Telegram –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ
‚îú‚îÄ‚îÄ üìÅ core/                       # Core utilities
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # Settings
‚îÇ   ‚îî‚îÄ‚îÄ geoparse.py               # AI + Nominatim
‚îÇ
‚îú‚îÄ‚îÄ üìÅ routers/                    # FastAPI —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ reports.py                # CRUD –¥–ª—è –∂–∞–ª–æ–±
‚îÇ
‚îú‚îÄ‚îÄ üìÅ lib/lib/                    # Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ main.dart                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ map_screen.dart       # –ö–∞—Ä—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create_complaint_screen.dart
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ ai_service.dart       # AI –∫–ª–∏–µ–Ω—Ç Flutter
‚îÇ
‚îú‚îÄ‚îÄ üìÅ tests/                      # –¢–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ test_main_api.py          # API —Ç–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ soobshio.db                    # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ Telegram Sessions/             # Telegram —Å–µ—Å—Å–∏–∏
```

---

## üåê API Endpoints

| Endpoint | Method | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| `/` | GET | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ |
| `/health` | GET | Health check |
| `/categories` | GET | –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| `/complaints` | GET | –°–ø–∏—Å–æ–∫ –∂–∞–ª–æ–± |
| `/complaints` | POST | –°–æ–∑–¥–∞—Ç—å –∂–∞–ª–æ–±—É |
| `/complaints/clusters` | GET | –ö–ª–∞—Å—Ç–µ—Ä—ã |
| `/stats` | GET | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `/ai/analyze` | POST | AI –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Zai ‚≠ê |

---

## ü§ñ Zai GLM-4.7

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from services.zai_service import analyze_complaint

result = await analyze_complaint("–Ø–º–∞ –Ω–∞ –õ–µ–Ω–∏–Ω–∞ 15")
# {"category": "—É–ª –õ–µ–Ω–∏–Ω–∞ 15", "address": null, "summary": "—è–º–∞"}
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (19)

1. –ñ–ö–•
2. –î–æ—Ä–æ–≥–∏
3. –ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
4. –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
5. –≠–∫–æ–ª–æ–≥–∏—è
6. –ñ–∏–≤–æ—Ç–Ω—ã–µ
7. –¢–æ—Ä–≥–æ–≤–ª—è
8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
9. –°–Ω–µ–≥/–ù–∞–ª–µ–¥—å
10. –û—Å–≤–µ—â–µ–Ω–∏–µ
11. –ú–µ–¥–∏—Ü–∏–Ω–∞
12. –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
13. –°–≤—è–∑—å
14. –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ
15. –ü–∞—Ä–∫–æ–≤–∫–∏
16. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ñ–µ—Ä–∞
17. –¢—Ä—É–¥–æ–≤–æ–µ –ø—Ä–∞–≤–æ
18. –ü—Ä–æ—á–µ–µ
19. –ß–ü

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Text ‚Üí Zai GLM-4.7 ‚Üí Category + Summary
                          ‚Üì
                    Nominatim ‚Üí lat/lng
```

---

## üìù .env –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=sqlite:///./soobshio.db

# Telegram
TG_API_ID=12345678
TG_API_HASH=your_hash
TG_PHONE=+1234567890
TG_BOT_TOKEN=123:ABC
TARGET_CHANNEL=-1001234567890

# Zai GLM-4.7 (–Ω–æ–≤—ã–π!)
ZAI_API_KEY=zai-xxxxx

# Anthropic Claude (fallback)
ANTHROPIC_API_KEY=sk-ant-...

# OpenAI (fallback)
OPENAI_API_KEY=sk-proj-...

# JWT
JWT_SECRET=your-secret
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### API –¢–µ—Å—Ç—ã

```bash
# Health check
curl http://127.0.0.1:8000/health

# Categories
curl http://127.0.0.1:8000/categories

# Create complaint
curl -X POST http://127.0.0.1:8000/complaints \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Test",
    "description": "Test",
    "latitude": 61.034,
    "longitude": 76.553,
    "category": "–î–æ—Ä–æ–≥–∏"
  }'

# AI Analyze
curl -X POST http://127.0.0.1:8000/ai/analyze \
  -H "Content-Type: application/json" \
  -d '{"text": "–Ø–º–∞ –Ω–∞ –õ–µ–Ω–∏–Ω–∞ 15"}'
```

### Python Tests

```bash
pytest tests/ -v
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ë—ã–ª–æ
- Claude 3.5 Haiku (Anthropic)
- –•–∞—Ä–¥–∫–æ–¥ API –∫–ª—é—á–µ–π
- –î—É–±–ª–∏–∫–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ –º–æ–¥–µ–ª–∏

### –°—Ç–∞–ª–æ
- Zai GLM-4.7 (–æ—Å–Ω–æ–≤–Ω–æ–π)
- Nominatim –¥–ª—è –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞
- –ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

---

## üìä –ú–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏

### Backend
- ‚úÖ FastAPI REST API
- ‚úÖ SQLAlchemy ORM
- ‚úÖ SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Zai GLM-4.7 AI
- ‚úÖ Nominatim –≥–µ–æ–∫–æ–¥–∏–Ω–≥
- ‚úÖ HDBSCAN –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ Telegram –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Frontend (Flutter)
- ‚úÖ –ö–∞—Ä—Ç–∞ —Å –∂–∞–ª–æ–±–∞–º–∏
- ‚úÖ –°–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∂–∞–ª–æ–±
- ‚úÖ AI –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ /ai/analyze
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### AI
- ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ (Zai)
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è (19 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—é–º–µ
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ–∞–π–ª—ã
- ‚úÖ –£–¥–∞–ª—ë–Ω models.py (–∫–æ—Ä–µ–Ω—å)
- ‚úÖ –£–¥–∞–ª—ë–Ω db.py (backend)
- ‚úÖ –ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –•–∞—Ä–¥–∫–æ–¥ API –∫–ª—é—á–µ–π
- ‚úÖ API –∫–ª—é—á–∏ –≤ .env
- ‚úÖ –ù–µ—Ç hardcoded –≤ –∫–æ–¥–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã __init__.py

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Async/await
- ‚úÖ –í—Å–µ async —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ httpx –≤–º–µ—Å—Ç–æ requests

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `PROJECT_REVISION.md` | –ü–æ–ª–Ω–∞—è —Ä–µ–≤–∏–∑–∏—è –ø—Ä–æ–µ–∫—Ç–∞ |
| `QUICKSTART.md` | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç |
| `ZAI_INTEGRATION.md` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Zai |
| `ZAI_COMPLETE.md` | –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ |
| `README.md` | –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Zai API –∫–ª—é—á**
   ```bash
   # –ü–æ–ª—É—á–∏—Ç—å –Ω–∞ zai.ai
   ZAI_API_KEY=zai-xxxxx
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```bash
   pip install zai-openai
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç**
   ```bash
   python main.py
   ```

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**
   ```bash
   curl -X POST http://127.0.0.1:8000/ai/analyze \
     -d '{"text": "–¢–µ—Å—Ç"}'
   ```

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
- ‚úÖ –†–µ–≤–∏–∑–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Zai
- ‚úÖ Flutter –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –¢–µ—Å—Ç—ã

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- Swagger UI: http://127.0.0.1:8000/docs
- –¢–µ—Å—Ç—ã: pytest tests/ -v
