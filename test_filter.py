"""Тест фильтрации сообщений"""
import sys, os
sys.path.insert(0, '.')
from start_monitoring import is_ad_or_spam, has_complaint_markers, is_relevant_message

tests = [
    # (текст, ожидаемый результат фильтра)
    ("Купи iPhone со скидкой 50%! Промокод SALE2026. Доставка бесплатно!", "ad"),
    ("Подписывайтесь на наш канал! Розыгрыш призов каждую неделю!", "ad"),
    ("Продаётся квартира 2к, ул. Ленина 15, 3.5 млн", "ad"),
    ("На ул. Мира 62 не работает освещение третий день, весь двор в темноте", "relevant"),
    ("Огромная яма на дороге по ул. Ленина 25, машины объезжают по тротуару", "relevant"),
    ("Прорвало трубу на проспекте Победы 12, вода заливает подвал", "relevant"),
    ("Сегодня в Нижневартовске солнечная погода, +5 градусов", "irrelevant"),
    ("Поздравляем всех с Днём города! Праздничный концерт в 18:00", "irrelevant"),
    ("ДТП на перекрёстке Ленина и Мира, столкнулись два автомобиля", "relevant"),
    ("Мусорные контейнеры переполнены на ул. Дзержинского 3, вонь ужасная", "relevant"),
    ("Гороскоп на сегодня: Овнам повезёт в любви, Тельцам — в финансах", "ad"),
    ("Вакансия: требуется сотрудник в магазин, зарплата от 40000", "ad"),
]

print(f"{'Результат':12s} | {'Ожидание':12s} | {'OK':3s} | Текст")
print("-" * 90)

ok = 0
for text, expected in tests:
    if is_ad_or_spam(text):
        result = "ad"
    elif is_relevant_message(text, "Прочее"):
        result = "relevant"
    else:
        result = "irrelevant"
    
    match = "✓" if result == expected else "✗"
    if result == expected:
        ok += 1
    print(f"{result:12s} | {expected:12s} | {match:3s} | {text[:55]}")

print(f"\n{ok}/{len(tests)} тестов пройдено")
